# Creates and configures an apache vhost, ensuring apache is installed beforehand.
---

- name: create site directory
  file: path="/var/www/{{ domain }}" state=directory owner="{{ ansible_user_id }}" group="{{ ansible_user_id }}"
  become: yes

- name: create virtual host file
  template: src=virtualhost.conf dest="/etc/apache2/sites-available/{{ domain }}.conf"
  become: yes

- name: enable site
  command: a2ensite "{{ domain }}"
  args:
    creates: "/etc/apache2/sites-enabled/{{ domain }}.conf"
  notify:
    - restart node
  become: yes
